
module load bowtie2/2.3.4.1
/usr/bin/modulecmd bash $*
LOADEDMODULES=slurm/19.05.0:openmpi/4.0.1-slurm-19.05.0:ggobi/2.1.11:texlive/2017:pandoc/2.0:netcdf/4.4.1.1:java/8:geos/3.7.1:gdal/2.1.3:hdf5/1.10.1:R/3.6.0:miniconda2/4.4.10:perl/5.20.2:less-highlight/1.0:iigb_utilities/1:vim/8.1:bowtie2/2.3.4.1 ;export LOADEDMODULES;PATH=/opt/linux/centos/7.x/x86_64/pkgs/bowtie2/2.3.4.1/bin:/opt/linux/centos/7.x/x86_64/pkgs/bowtie2/2.3.4.1/scripts:/opt/linux/centos/7.x/x86_64/pkgs/vim/8.1/bin:/opt/linux/centos/7.x/x86_64/pkgs/iigb_utilities/1/bin:/opt/linux/centos/7.x/x86_64/pkgs/perl/5.20.2/bin:/opt/linux/centos/7.x/x86_64/pkgs/miniconda2/4.4.10/bin:/opt/linux/centos/7.x/x86_64/pkgs/hdf5/1.10.1/bin:/opt/linux/centos/7.x/x86_64/pkgs/gdal/2.1.3/bin:/opt/linux/centos/7.x/x86_64/pkgs/geos/3.7.1/bin:/opt/linux/centos/7.x/x86_64/pkgs/java/jdk1.8.0_45/bin:/opt/linux/centos/7.x/x86_64/pkgs/netcdf/4.4.1.1/bin:/opt/linux/centos/7.x/x86_64/pkgs/pandoc/2.0/bin:/opt/linux/centos/7.x/x86_64/pkgs/texlive/2017/bin/x86_64-linux:/opt/linux/centos/7.x/x86_64/pkgs/ggobi/2.1.11/bin:/opt/linux/centos/7.x/x86_64/pkgs/R/3.6.0/bin:/opt/linux/centos/7.x/x86_64/pkgs/openmpi/4.0.1-slurm-19.05.0/bin:/opt/linux/centos/7.x/x86_64/pkgs/slurm/19.05.0/bin:/opt/linux/centos/7.x/x86_64/pkgs/slurm/19.05.0/sbin:/usr/bin:/bin:/usr/local/games:/usr/games:/usr/local/bin:/usr/lpp/mmfs/bin:/opt/ibutils/bin ;export PATH;_LMFILES_=/opt/linux/centos/7.x/x86_64/modules/slurm/19.05.0:/opt/linux/centos/7.x/x86_64/modules/openmpi/4.0.1-slurm-19.05.0:/opt/linux/centos/7.x/x86_64/modules/ggobi/2.1.11:/opt/linux/centos/7.x/x86_64/modules/texlive/2017:/opt/linux/centos/7.x/x86_64/modules/pandoc/2.0:/opt/linux/centos/7.x/x86_64/modules/netcdf/4.4.1.1:/opt/linux/centos/7.x/x86_64/modules/java/8:/opt/linux/centos/7.x/x86_64/modules/geos/3.7.1:/opt/linux/centos/7.x/x86_64/modules/gdal/2.1.3:/opt/linux/centos/7.x/x86_64/modules/hdf5/1.10.1:/opt/linux/centos/7.x/x86_64/modules/R/3.6.0:/opt/linux/centos/7.x/x86_64/modules/miniconda2/4.4.10:/opt/linux/centos/7.x/x86_64/modules/perl/5.20.2:/opt/linux/centos/7.x/x86_64/modules/less-highlight/1.0:/opt/linux/centos/7.x/x86_64/modules/iigb_utilities/1:/opt/linux/centos/7.x/x86_64/modules/vim/8.1:/opt/linux/centos/7.x/x86_64/modules/bowtie2/2.3.4.1 ;export _LMFILES_;
#module unload miniconda3 python anaconda2 anaconda3
#module load python/2.7.14
#module load miniconda2
conda activate DaturaPy2
PS1='(DaturaPy2) '
export PATH='/rhome/arajewski/.conda/envs/DaturaPy2/bin:/opt/linux/centos/7.x/x86_64/pkgs/bowtie2/2.3.4.1/bin:/opt/linux/centos/7.x/x86_64/pkgs/bowtie2/2.3.4.1/scripts:/opt/linux/centos/7.x/x86_64/pkgs/vim/8.1/bin:/opt/linux/centos/7.x/x86_64/pkgs/iigb_utilities/1/bin:/opt/linux/centos/7.x/x86_64/pkgs/perl/5.20.2/bin:/opt/linux/centos/7.x/x86_64/pkgs/miniconda2/4.4.10/bin:/opt/linux/centos/7.x/x86_64/pkgs/hdf5/1.10.1/bin:/opt/linux/centos/7.x/x86_64/pkgs/gdal/2.1.3/bin:/opt/linux/centos/7.x/x86_64/pkgs/geos/3.7.1/bin:/opt/linux/centos/7.x/x86_64/pkgs/java/jdk1.8.0_45/bin:/opt/linux/centos/7.x/x86_64/pkgs/netcdf/4.4.1.1/bin:/opt/linux/centos/7.x/x86_64/pkgs/pandoc/2.0/bin:/opt/linux/centos/7.x/x86_64/pkgs/texlive/2017/bin/x86_64-linux:/opt/linux/centos/7.x/x86_64/pkgs/ggobi/2.1.11/bin:/opt/linux/centos/7.x/x86_64/pkgs/R/3.6.0/bin:/opt/linux/centos/7.x/x86_64/pkgs/openmpi/4.0.1-slurm-19.05.0/bin:/opt/linux/centos/7.x/x86_64/pkgs/slurm/19.05.0/bin:/opt/linux/centos/7.x/x86_64/pkgs/slurm/19.05.0/sbin:/usr/bin:/bin:/usr/local/games:/usr/games:/usr/local/bin:/usr/lpp/mmfs/bin:/opt/ibutils/bin'
export CONDA_SHLVL='1'
export CONDA_PROMPT_MODIFIER='(DaturaPy2) '

export PATH=/rhome/arajewski/bigdata/Datura/software/ScaffMatch:$PATH

#define insert size for file names
insert=(500 1000 2000 4000 6000 8000 10000 12000 14000 16000 18000 20000 30000 40000 50000 60000 70000 80000 100000 120000 150000 180000)
obsinsert=(414 921 1934 3961 5990 8019 10042 12067 14000 16000 18000 20000 30000 40000 50000 60000 70000 80000 100000 120000 150000 180000)
#set sd to 10% of insert size
a=0

#hardcore SD of insert size bc the loop is messing up
sdinsert=(41 92 193 396 599 801 1004 1206 1400 1600 1800 2000 3000 4000 5000 6000 7000 8000 10000 12000 15000 18000)

#for i in ${obsinsert[@]}
#do 
#    sdinsert[${a}]=$((i*10/100))
#    ((a++))
#done

echo $a
0
echo ${sdinsert[@]}
41 92 193 396 599 801 1004 1206 1400 1600 1800 2000 3000 4000 5000 6000 7000 8000 10000 12000 15000 18000

for i in $(seq 0 $((${#insert[@]}-1)))
do
    echo $(date): $i
    if [ $i -lt 1 ]; then
	echo $(date): Running iteration $((i+1)) of Scaffmatch.
	mkdir -p Dstr_v1.3_k101-i${insert[i]}
	scaffmatch \
	    -m \
	    -w Dstr_v1.3_k101-i${insert[i]} \
	    -c /rhome/arajewski/bigdata/Datura/2_ABySS/k_101/Dstr_v1.3_k101-scaffolds.fa \
	    -s ${sdinsert[i]} \
	    -i ${obsinsert[i]} \
	    -p fr \
	    -1 ultra_ont_raw.I${insert[i]}.FastSG_K22.sam.fwd.sam \
	    -2 ultra_ont_raw.I${insert[i]}.FastSG_K22.sam.rev.sam 
    fi
    if [ $i -gt 0 ]; then
	#second through nth iteration
	mkdir -p Dstr_v1.3_k101-i${insert[i]}
	scaffmatch \
	    -m \
	    -w Dstr_v1.3_k101-i${insert[i]} \
	    -c Dstr_v1.3_k101-i${insert[i-1]}/scaffolds.da \
	    -s ${sdinsert[i]} \
	    -i ${obsinsert[i]} \
	    -p fr \
	    -1 ultra_ont_raw.I${insert[i]}.FastSG_K22.sam.fwd.sam \
	    -2 ultra_ont_raw.I${insert[i]}.FastSG_K22.sam.rev.sam
   fi
done
Tue Nov 26 13:11:16 PST 2019: 0
Tue Nov 26 13:11:16 PST 2019: Running iteration 1 of Scaffmatch.
Running ScaffMatch
2019-11-26 13:11:20,547 - INFO - **--**--**--**--**--**--**--**--**--**--**--**--**--**--**--**--**
2019-11-26 13:11:20,550 - INFO - Settings used for this run of ScaffMatch are:
2019-11-26 13:11:20,550 - INFO -     scaff_dir  -- Dstr_v1.3_k101-i500
2019-11-26 13:11:20,550 - INFO -     ctg_fasta  -- /rhome/arajewski/bigdata/Datura/2_ABySS/k_101/Dstr_v1.3_k101-scaffolds.fa
2019-11-26 13:11:20,550 - INFO -     libraries  -- {1: {'std': 41, 'sam2': 'ultra_ont_raw.I500.FastSG_K22.sam.rev.sam', 'sam1': 'ultra_ont_raw.I500.FastSG_K22.sam.fwd.sam', 'pm': 'fr', 'ins': 414}}
2019-11-26 13:11:20,550 - INFO -     bundle_threshold  -- 5
2019-11-26 13:11:20,550 - INFO -     log_file  -- NONE
2019-11-26 13:11:20,550 - INFO - Stage I: Construct scaffolding graph
2019-11-26 13:19:06,570 - INFO - Scaffolding graph constructed: 466.019691944
2019-11-26 13:19:06,585 - INFO - Stage II: Performing matching heuristics (max_weight)
slurmstepd-i35: error: *** JOB 504095 ON i35 CANCELLED AT 2019-11-29T13:11:14 DUE TO TIME LIMIT ***
